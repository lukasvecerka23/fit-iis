<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0067)https://www.fit.vutbr.cz/study/courses/IIS/private/projekt/doc.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
    
    <title>Projekt IIS</title>
    <style type="text/css">
    	table { border-collapse: collapse; }
    	td, th { border: 1px solid black; padding: 0.3em 0.5em; text-align: left; }
    	dt { font-weight: bold; margin-top: 0.5em; }
    </style>
<script src="chrome-extension://nngceckbapebfimnlniiiahkandclblb/content/fido2/page-script.js"></script></head>
<body>

<!-- Zkontrolujte pros?m nastaven? k?dov?n? v hlavi?ce dokumentu 
     podle pou?it?ho editoru -->

<h1>IoT správa zaøízení</h1> <!-- Nahradte n?zvem sv?ho zad?n? -->

<dl>
	<dt>Autoøi</dt>
	<dd>Luká¹ Veèerka <!-- Nahra?te skute?n?m jm?nem a e-mailem autora a popisem ?innosti -->
	    <a href="mailto:xvecer30@stud.fit.vutbr.cz">xvecer30@stud.fit.vutbr.cz</a> -
		konfigurace databáze, implementace backendu, implementace frontendu
	</dd>
	<dd>Veronika Nevaøilová <!-- Nahra?te skute?n?m jm?nem a e-mailem autora a popisem ?innosti -->
	    <a href="mailto:xnevar00@stud.fit.vutbr.cz">xnevar00@stud.fit.vutbr.cz</a> - 
		design, implementace frontendu, implementace backendu
	</dd>
	<dt>URL aplikace</dt>
	<dd><a href="https://app-iis-2023-web.azurewebsites.net/">https://app-iis-2023-web.azurewebsites.net/</a></dd>
</dl>

<h2>U¾ivatelé systému pro testování</h2>
<table>
<tbody><tr><th>Login</th><th>Heslo</th><th>Role</th></tr>
<tr><td>admin</td><td>admin</td><td>Administrátor</td></tr>
<tr><td>broker</td><td>broker</td><td>Prodavaè</td></tr>
<tr><td>johndoe</td><td>test123</td><td>U¾ivatel</td></tr>
<tr><td>ironmanisawesome</td><td>test123</td><td>U¾ivatel</td></tr>
</tbody></table>

<h3>Video</h3>

<a href="https://drive.google.com/file/d/1UiDJzxcKxKL7KstCcYeAlAr1sLBVRrYF/view?usp=sharing">Video</a>

<h2>Implementace</h2>

<h3>Architektura</h3>
<h4>Frontend</h4>
<p>Frontend jsme implementovali pomocí Javascriptového framworku Svelte. Pro komunikaci s backendem pou¾íváme asynchroní volání pomocí
fetch. V aplikaci validujeme vstupy u¾ivatelù a podle u¾ivatelovi role zobrazujeme rùzné èásti aplikace. Díky frameworku jsme schopni 
zajistit reaktivitu aplikace</p>
<h4>Backend</h4>
<p>Backend jsme implementovali pomocí frameworku ASP.NET Core. Pro práci s databází pou¾íváme Entity Framework Core. Pro autentizaci a autorizaci
ukládáme na stranì klienta JWT token v Cookies.</p>
<h4>Databáze</h4>
<p>Databázi jsme pou¾ili MS SQL, proto¾e aplikaci nasazujeme na Azure a tato databáze se tam nasazuje nejlépe. Pro lokální vývoj jsme databázi spustili jako 
kontejner Docker. Inicializace databáze se provádí pomocí Entity Framework Core, ve kterém je vytvoøen tzv. DbContext, podle kterého je databáze vytvoøena
a jsou v ní ulo¾eny data pro testování.</p>

<h3>Popis API</h3>
<h4>Pøihlá¹ení a odhlá¹ení</h4>
<p>Pro autentizaci jsme implementovali kontroler AuthController, který má nìkolik koncových bodù. Po úspì¹ném pøihlá¹ení je u¾ivateli vygenerován JWT token s potøebnými atributy.
Tento token je ulo¾en v Cookies na klientovi. Pøi odhlá¹ení jsou tyto cookies smazány. Nové u¾ivatele vytváøí administrátor.
</p>
<h4>Systémy</h4>
<p>Pro práci se systémy jsme implementovali kontroler SystemsController. Na hlavní stránce je seznam systému, ve kterém se dá vyhledávat a je stránkován. Pro periodické aktualizace stavu systému je
pou¾it polling pomocí setInterval. Stav systému vidí jen u¾ivatelé, kteøí mají pøístup do systému nebo jsou správci tohoto systému. U¾ivatel, který nemá pøístup do tohoto systému o nìj mù¾e po¾ádat.
Stavy systému jsou následovné - v poøádku - v¹echny zaøízení jsou ve stavu OK, varování - alespoò jedno zaøízení je ve stavu Varování nebo Chyba, chyba - v¹echny zaøízení jsou ve stavu Chyba.
</p>
<h4>Zaøízení</h4>
<p>Pro práci se zaøízeními jsme implementovali kontroler DevicesController. Pøihlá¹ený u¾ivatel má pøístup do zálo¾ky Zaøízení, ve kterém vidí buï zaøízení, které vytvoøil a nebo zaøízení ze systému, který monitoruje. U zaøízeních vidí stav, který je periodicky
aktualizován stejnì jak u systémù. Je zde mo¾nost vyhledávání a stránkování. Stavy zaøízení jsou - OK - v¹echny KPI jsou ve stavu OK, varování - alespoò jedno KPI je ve stavu Chyba, chyba - v¹echny KPI jsou ve stavu Chyba. V detailu zaøízení mù¾e u¾ivatel
kontrolovat dané KPI a u jednotlivých KPI vidí jestli jsou ve stavu Chyba nebo ne. Je zde i seznam parametrù daného typu zaøízení. U parametrù mù¾eme vidìt stav - OK - v¹echny KPI jsou OK, varování - alespoò jedno KPI je ve stavu Chyba, chyba - v¹echny KPI jsou ve stavu Chyba.
U¾ivatel, který zaøízení vytvoøil ho mù¾e editovat nebo smazat. V zálo¾ce mìøení najdeme seznam mìøení seøazený podle data. Pøi kliknutí na parametr si mù¾e u¾ivatel vyfiltrovat KPI a mìøení podle tohoto parametru.
<h4>U¾ivatelé</h4>
<p>Pro práci s u¾ivateli jsme implementovali kontroler UsersController. Administrátor mù¾e editovat, mazat a vytváøet nové u¾ivatele a mù¾e mìnit role u¾ivatelù.</p>
<h4>Role</h4>
<p>Pro práci s rolí jsme implementovali kontroler RolesController. V systémù jsou tyto 3 role - <strong>Administrátor</strong>, <strong>U¾ivatel</strong>, <strong>Broker</strong></p>
<h4>Typy zaøízení</h4>
<p>Pro práci s typy zaøízení jsme implementovali kontroler DeviceTypesController. Administrátor mù¾e vytváøet nové typy zaøízení,
	které jsou sdíleny mezi v¹emi u¾ivateli systému.
	</p></p>
<h4>KPI</h4>
<p>Pro práci s KPI jsme implementovali kontroler KpiController. U¾ivatel mù¾e zadefinovat funkci KPI (>, <, =, !=, >=, <=) a hodnotu. Pokud poslední mìøení, nesplní tuto funkci, je KPI vyhodnoceno jako chyba.</p>
<h4>Mìøení</h4>
<p>Pro práci s mìøeními jsme implementovali kontroler MeasurementsController. Na stránce mìøení mù¾e buï u¾ivatel v roli broker nebo admin pøidávat mìøení k jednotlivým zaøízením. Po pøidání nového pìøení jsou aktualizovány stavy KPI pro parametr a zaøízení tohoto mìøení.
Pøi vytvoøení mìøení je ulo¾eno aktuální datum v UTC formátu.
</p>
<h4>Parametry</h4>
<p>Pro práci s parametry jsme implementovali kontroler ParametersController. Pøi vytváøení nového typu zaøízení mù¾e administrátor specifikovat jeho parametry. Ty jsou potom aplikovány na v¹echny zaøízení, které jsou tento typ. Parametr mù¾e mít horní a spodní limit hodnoty.
Admin nebo broker mù¾e pøidat mìøení jen v tomto limitu.
</p>
<h4>®ádosti o pøístup do systému</h4>
<p>Pro práci s ¾ádostmi o pøístup do systému jsme implementovali kontroler AssignToSystemController. U¾ivatelé mù¾ou za¾ádat o pøístup do systému a vidí stav této ¾ádosti na hlavní stránce se systémy. Pokud je pøístup za¾ádán ale nepotvrzel, lze vidìt stav v Èeká na vyøízení
V pøípadì, ¾e je pøístup potvrzen, je u¾ivatel pøidán do sýstému a ¾ádost je smazána. Pokud je pøístup zamítnut, je ¾ádost smazána.
</p>

<p>Podrobná dokumentace jednotlivých kontrolerù je dostupná ná koncovém bodu /swagger/index.html</p>

<h3>Databáze</h3>

<img src="./er_iss_small.png" alt="ER diagram" style="width: 100%;"/>

<h2>Instalace</h2>
<ul>
<li>nasazení na server jsme nakonfigurovali pomocí GitHub actions, dojde k vytvoøení aplikace pomocí dotnet publish, která se nahraje na Azure Web App server a spustí se</li>
<li>SW po¾adavky - .NET Core 7, ASP.NET Core, Node.js 18.16.0</li>
<li>konfigurace backendu se dìlá pomocí appsettings.json ve slo¾ce API, je nutné zadat øetìzec pro pøipojení do databáze, inicializace databáze pak probìhne automaticky pøí spu¹tìní aplikace pomocí dbContext v .NET</li>
<li>pro inicializaci frontendu je nutné spustit pøíkaz npm install, který nainstaluje potøebné balíèky, do souboru src/config.js je pak nutné vlo¾it URL adresu API</li>
</ul>

<h2>Známé problémy</h2>
<p>Pøi editaci zaøízení po zmìnì typu zaøízení by se správnì mìly vymazat v¹echny KPI, proto¾e zaøízení bude mít nové parametry. Z èasových dùvodù jsme toto nestihli o¹etøit.</p>



</body></html>